{% extends 'base.html' %}

{% block title %}Expenses - BudGenie{% endblock %}

{% block content %}
<div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
    <h1 class="text-3xl font-bold">Expenses</h1>
    <div class="flex gap-2">
        <a href="{% url 'expense_export' %}" class="btn btn-outline btn-primary">
            <i class="fa-solid fa-file-export mr-2"></i>
            Export CSV
        </a>
        <a href="{% url 'expense_add' %}" class="btn btn-primary">
            <i class="fa-solid fa-plus mr-2"></i>
            Add Expense
        </a>
    </div>
</div>

<!-- Filters -->
<div class="card bg-base-100 shadow-sm mb-8">
    <div class="card-body p-4">
        <form method="get" class="flex flex-wrap gap-4 items-end">
            <div class="form-control w-full md:w-auto">
                <label class="label py-1">
                    <span class="label-text text-xs">Category</span>
                </label>
                <select name="category" class="select select-bordered select-sm w-full md:w-48">
                    <option value="">All Categories</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-control w-full md:w-auto">
                <label class="label py-1">
                    <span class="label-text text-xs">From Date</span>
                </label>
                <input type="date" name="date_from" value="{{ request.GET.date_from }}" class="input input-bordered input-sm">
            </div>
            
            <div class="form-control w-full md:w-auto">
                <label class="label py-1">
                    <span class="label-text text-xs">To Date</span>
                </label>
                <input type="date" name="date_to" value="{{ request.GET.date_to }}" class="input input-bordered input-sm">
            </div>
            
            <button type="submit" class="btn btn-primary btn-sm">Filter</button>
            <a href="{% url 'expense_list' %}" class="btn btn-ghost btn-sm">Clear</a>
        </form>
    </div>
</div>

<!-- Expense List -->
<div class="overflow-x-auto bg-base-100 rounded-box shadow-xl">
    <table class="table table-zebra">
        <thead>
            <tr>
                <th>Date</th>
                <th>Title</th>
                <th>Category</th>
                <th>Type</th>
                <th>Amount</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for expense in expenses %}
            <tr>
                <td>{{ expense.date }}</td>
                <td class="font-medium">{{ expense.title }}</td>
                <td>
                    {% if expense.category %}
                    <span class="badge badge-outline" style="border-color: {{ expense.category.color }}; color: {{ expense.category.color }}">
                        {{ expense.category.name }}
                    </span>
                    {% else %}
                    <span class="badge badge-ghost">Uncategorized</span>
                    {% endif %}
                </td>
                <td>
                    {% if expense.transaction_type == 'INCOME' %}
                        <span class="badge badge-success badge-outline gap-2">
                            <i class="fa-solid fa-arrow-trend-up"></i> Income
                        </span>
                    {% else %}
                        <span class="badge badge-error badge-outline gap-2">
                            <i class="fa-solid fa-arrow-trend-down"></i> Expense
                        </span>
                    {% endif %}
                </td>
                <td class="font-bold {% if expense.transaction_type == 'INCOME' %}text-success{% else %}text-error{% endif %}">
                    {% if expense.transaction_type == 'INCOME' %}+{% else %}-{% endif %}₹{{ expense.amount }}
                </td>
                <td>
                    <div class="join">
                        <a href="{% url 'expense_edit' expense.pk %}" class="btn btn-xs btn-ghost join-item">Edit</a>
                        <a href="{% url 'expense_delete' expense.pk %}" class="btn btn-xs btn-ghost text-error join-item">Delete</a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center py-10 text-gray-500">No expenses found matching your filters.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if is_paginated %}
<div class="flex justify-center mt-8">
    <div class="join">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="join-item btn">«</a>
        {% else %}
        <button class="join-item btn btn-disabled">«</button>
        {% endif %}
        
        <button class="join-item btn">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</button>
        
        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="join-item btn">»</a>
        {% else %}
        <button class="join-item btn btn-disabled">»</button>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}
